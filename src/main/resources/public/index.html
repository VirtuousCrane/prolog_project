<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="modules/core.js"></script>
    <script type="text/javascript" src="modules/lists.js"></script>
    <script type="text/javascript" src="modules/dom.js"></script>
    <script type="text/javascript">
        var program = String.raw`
:- use_module(library(lists)).
:- use_module(library(dom)).

operator("a").
operator("s").
operator("m").
operator("d").

get_rpn_result(RPNNotation, Result):-
    calculate_rpn(Result, [], RPNNotation).
push(X, S, [X|S]).

pop([X|S], X, S).


calculate_rpn(Result, [Result], []):- !.
calculate_rpn(R, S, [Num|T]):-
    number(Num),
    push(Num, S, PushedStack),
    !,
    calculate_rpn(R, PushedStack, T).

calculate_rpn(X, S, [Operator|T]):-
    operator(Operator) = operator("a"),
    pop(S, Operand1, S1),
    pop(S1, Operand2, S2),
    Operated_result is Operand2 + Operand1,
    !,
    calculate_rpn(X, [Operated_result|S2], T).

calculate_rpn(X, S, [Operator|T]):-
    operator(Operator) = operator("s"),
    pop(S, Operand1, S1),
    pop(S1, Operand2, S2),
    Operated_result is Operand2 - Operand1,
    !,
    calculate_rpn(X, [Operated_result|S2], T).

calculate_rpn(X, S, [Operator|T]):-
    operator(Operator) = operator("m"),
    pop(S, Operand1, S1),
    pop(S1, Operand2, S2),
    Operated_result is Operand2 * Operand1,
    !,
    calculate_rpn(X, [Operated_result|S2], T).

calculate_rpn(X, S, [Operator|T]):-
    operator(Operator) = operator("d"),
    pop(S, Operand1, S1),
    pop(S1, Operand2, S2),
    Operand1 \= 0,
    Operated_result is Operand2 / Operand1,
    !,
    calculate_rpn(X, [Operated_result|S2], T).

get_infix(RPN, Infix):-
    rpn_to_infix(RPN, [], Infix).

rpn_to_infix([], [Result], Result).

rpn_to_infix([HeadRPN|RestOfRPN], Stack, Result):-
    number(HeadRPN),
    !,
    rpn_to_infix(RestOfRPN, [HeadRPN|Stack], Result).

rpn_to_infix([HeadRPN|RestOfRPN], Stack, Result):-
    rpn_calculator:operator(HeadRPN),
    pop(Stack, X, S1),
    pop(S1, Y, S2),
    push([Y,HeadRPN,X], S2, S3),
    !,
    rpn_to_infix(RestOfRPN, S3, Result).


get_countdown_rpn(NumList, Target, RPNNotation):-
    get_valid_rpn(NumList, RPNNotation, Target).

get_countdown_infix(NumList, Target, InfixNotation):-
    get_countdown_rpn(NumList, Target, RPNNotation),
    get_infix(RPNNotation, InfixNotation).

all_operator([]).
all_operator([H|T]):-
    operator(H),
    all_operator(T).

get_operator_combination_with_repetition_list(Len, X):-
    length(X, Len), % produce list of holding variable such as [_, _, _,]
    all_operator(X),
    msort(X, X). % Check if list is sorted, does not remove duplicates

concat_list([], List, List).
concat_list([H|List1], X, [H|List3]):-
    concat_list(List1, X, List3).

get_number_operator_list(NumList, X):-
    length(NumList, NumListLength),
    OperatorListLength is NumListLength-1,
    get_operator_combination_with_repetition_list(OperatorListLength, OperatorList),
    concat_list(NumList, OperatorList, X).

get_valid_rpn(NumList, RPNNotation, RPNResult):-
    get_number_operator_list(NumList, NumOperatorList),
    permutation(NumOperatorList, RPNNotation),
    get_rpn_result(RPNNotation, RPNResult).
        `;
        const QUERY_LIMIT = 10000000;
        var session = pl.create(QUERY_LIMIT);

        session.consult(program,{
            success: function() {
                console.log("SUCCESS");
                session.query("get_countdown_infix([1, 2, 3, 4], 11, X).", {
                    success: function(goal) {
                        console.log("QUERY SUCCESS");
                        session.answer({
                            success: function(ans) {
                                console.log("ANSWER SUCCESS");
                                console.log(session.format_answer(ans));
                            },
                            error: function(err) {
                                console.log("ERROR");
                                console.log(err);
                            },
                        });
                    },
                    error: function(err) {
                        console.log("QUERY FAILED");
                        console.log(err);
                    },
                });
            }, error: function(err) {
                console.log(err);
            },
        });
    </script>
</head>
<body>
    <div id="main">
        <div id="game-container">
            <div id="game-container-header">
                Game Title
            </div>
            <div id="game-container-body">
                <div id="input-container-header">
                    <div id="left-input">
                        <form>
                            <input class="user-input" type="text"></input>
                            <input class="user-input" type="text"></input>
                            <input class="user-input" type="text"></input>
                            <input class="user-input" type="text"></input>
                        </form>
                    </div>
                    <div id="right-input">
                        <form>
                            <input class="user-input" type="text" placeholder='Target'></input>
                        </form>
                    </div>
                </div>
                <div id="input-container-footer">
                    <form>
                        <input id="submit-user-input" type="button" value="Submit"></input>
                    </form>
                </div>
            </div>
            <div id="game-container-footer"></div>
        </div>
    </div>
</body>
</html>